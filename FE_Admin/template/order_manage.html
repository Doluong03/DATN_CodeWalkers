<div class="col-lg-12 grid-margin stretch-card">
  <div class="card">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title">Quản lý đơn hàng</h5>
        <ul class="nav nav-tabs card-header-tabs" data-bs-tabs="tabs">
          <li class="nav-item">
            <button class="nav-link active" aria-current="true" data-bs-toggle="tab" ng-click="getByStatus(0)">Tất
              cả</button>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#static" ng-click="getByStatus(1)">Chờ xác nhận</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#static" ng-click="getByStatus(2)">Chờ giao hàng</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#static" ng-click="getByStatus(1)">Đang giao hàng</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#static" ng-click="getByStatus(3)">Đã Giao</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#static" ng-click="getByStatus(4)">Đã hủy</a>
          </li>
        </ul>
      </div>
      <div class="card-body">
        <h4 class="card-title">User table</h4>
        <div class="search-container">
          <input type="text" id="btn-search" ng-model="searchText" placeholder="Search a User">
          <i class="fa-light fa-magnifying-glass"></i>
        </div>
        <button ng-click="deleteAll()" id="delete-all" class="btn btn-danger"><i class="fa-duotone fa-trash"></i> Xoá
          Nhiều</button>
        <div class="btn-group">

          <button type="button" id="btn-icon" class="btn btn-secondary" ng-click="toggleForm()">
            <i class="fa-solid fa-plus fa-lg" style="color: #ffffff;"></i></button>

          <button type="button" id="btn-icon" class="btn btn-secondary" ng-click="reLoad()">
            <i class="fa-solid fa-arrows-rotate "></i>
          </button>



          <div class="btn-group">
            <button type="button" class="btn btn-secondary dropdown-toggle" id="dropdownMenuIconButton3"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fa-solid fa-list"></i>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuIconButton3">
              <label class="dropdown-item">
                <input type="checkbox" ng-model="selectAll" ng-change="toggleAll()"> Chọn Tất Cả
              </label>
              <hr>
              <label class="dropdown-item" ng-repeat="column in columns">
                <input type="checkbox" ng-model="column.selected" ng-change="toggleColumn(column)">
                {{ column.name }}
              </label>
            </div>
          </div>


          <input type="file" id="input-file" onchange="angular.element(this).scope().import(this.files)"
            style="display:none;">
          <button type="button" id="btn-icon" class="btn btn-secondary " onclick="triggerFileInput()">
            <i class="fa-sharp fa-solid fa-file-import"></i>
          </button>

          <!-- <button type="button" id="btn-icon" class="btn btn-secondary" ng-click="exportToExcel()"> Excel</button>
                      <button type="button" id="btn-icon" class="btn btn-secondary" ng-click="exportToSVG()">SVG</button> -->


          <div class="btn-group">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuIconButton1"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fa-solid fa-down-to-line"></i>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuIconButton1">
              <a class="dropdown-item" ng-click="exportToSVG()">SVG</a>
              <a class="dropdown-item" ng-click="exportToExcel()">Excel</a>
              <a class="dropdown-item" ng-click="exportToPDF();">PDF</a>
            </div>
          </div>

        </div>


        <!-- start table -->
        <div class="table-responsive pt-3">
          <table class="table expandable-table table-hover" style="width: 100%" id="UserTable">
            <thead>
              <tr>
                <th>
                  <input ng-model="selectAllCheckbox" ng-change="selectAllChanged()" class="select-checkbox"
                    type="checkbox"> #
                </th>
                <th ng-show="columns[1].selected" ng-click="sortData('name')">Mã hóa đơn<span
                    class="{{getSortClass('name')}}"><i class="fas fa-sort"></i></span></th>
                <th ng-show="columns[2].selected" ng-click="sortData('dateOfBirth')">Khách Hàng<span
                    class="{{getSortClass('dateOfBirth')}}"><i class="fas fa-sort"></i></span></th>
                <th ng-show="columns[3].selected" ng-click="sortData('gender')">Số điện thoại<span
                    class="{{getSortClass('gender')}}"><i class="fas fa-sort"></i></span></th>
                <th ng-show="columns[4].selected" style="text-align: center;" ng-click="sortData('address')">Nhân
                  viên<span class="{{getSortClass('address')}}"><i class="fas fa-sort"></i></span></th>
                <th ng-show="columns[5].selected" ng-click="sortData('email')">Tổng tiền<span
                    class="{{getSortClass('email')}}"><i class="fas fa-sort"></i></span></th>
                <th ng-show="columns[6].selected" ng-click="sortData('phoneNumber')">Ngày mua<span
                    class="{{getSortClass('phoneNumber')}}"><i class="fas fa-sort"></i></span></th>
                <th name="Action">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="item in listOrders | filter:searchText | orderBy:sortColumn:reverseSort"
                class="align-middle text-center">
                <td><input type="checkbox" ng-model="item.isSelected"></td>
                <td ng-show="columns[1].selected">{{ item.code }}</td>
                <td ng-show="columns[2].selected">{{ item.users[0].name}}</td>
                <td ng-show="columns[3].selected">{{ item.users[0].phoneNumber }}</td>
                <td ng-show="columns[4].selected">{{ item.staff[0].name }}</td>
                <td ng-show="columns[5].selected">{{ item.totalPay | vndCurrency }}</td>
                <td ng-show="columns[6].selected">{{ item.createdAt |dateformat }}</td>
                <td>
                  <!-- <a href="#" ng-click="toggleFormUpdate($event, item)" style="text-decoration: none; color: #1545e1;">
                        <i class="fa-solid fa-pen-to-square"></i>
                      </a>
                      <a href="#" ng-click="removeStaff($event, item)" style="text-decoration: none; color: #FC424A;">
                        <i class="fas fa-fw fa-trash"></i>
                      </a> -->
                  <a href="#" ng-click="toggleFormUpdate($event, item)" data-toggle="modal"
                    data-target="#userUpdateModal" style="text-decoration: none; color: rgb(62, 44, 165);">
                    <i class="fa fa-eye" aria-hidden="true"></i>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
          <hr>
          <!-- phân trang -->
          <nav id="phantrang" aria-label="Page navigation example" style="color: #000000;">
            <p style="margin-top: 20px;">Đang xem {{listOrders[0].code.slice(5)}} đến {{lastIndex}} trong tổng số
              {{sizePage}} mục</p>
            <!-- Phân trang -->
            <div class="row m-1">
              <div id="sizePage" class="col  h-25">
                <label for="itemsPerPage">Xem:</label>
                <select id="itemsPerPage" ng-model="sizePage" ng-init="sizePage = '5'" ng-change="onSizePageChange()">
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="100">100</option>
                </select>
                <label for="itemsPerPage">mục</label>
              </div>
              <ul class="pagination justify-content-end col me-2">
                <!-- Các nút phân trang ở đây -->
                <li class="page-item"
                  ng-class="{ 'disabled': pageCurrent === 0, 'hovered': hoveredPage === 'previous' }">
                  <a class="page-link" ng-click="previousPage()" ng-class="{ 'disabled-link': pageCurrent === 0 }"
                    ng-mouseenter="onHover('previous')" ng-mouseleave="onLeave()"><span
                      aria-hidden="true">&laquo;</span></a>
                </li>
                <li class="page-item" ng-repeat="page in pageRange()"
                  ng-class="{ 'active': page === pageCurrent, 'hovered': hoveredPage === page }">
                  <a class="page-link" ng-click="PageNo(page, sizePage)" ng-mouseenter="onHover(page)"
                    ng-mouseleave="onLeave()">{{ page }}</a>
                </li>

                <li class="page-item"
                  ng-class="{ 'disabled': pageCurrent === totalPage - 1, 'hovered': hoveredPage === 'next' }">
                  <a class="page-link" ng-click="nextPage()"
                    ng-class="{ 'disabled-link': pageCurrent === totalPage - 1 }" ng-mouseenter="onHover('next')"
                    ng-mouseleave="onLeave()"> <span aria-hidden="true">&raquo;</span></a>
                </li>
              </ul>
            </div>
          </nav>

          <!-- kết thúc phân trang -->
        </div>
      </div>
    </div>
  </div>

  <!-- form update -->
  <style>
    .modal-dialog .modal-content {
      width: 1400px;
      margin-top: -50px;
      right: 70%;
    }

    .scrollable-modal-body {
      max-height: 800px;
      /* Điều chỉnh chiều cao tối đa theo ý muốn */
      overflow-y: auto;
      /* Tạo thanh cuộn dọc */
    }
  </style>
  <div class="modal fade justify-items-center" id="userUpdateModal" tabindex="-1" role="dialog"
    aria-labelledby="userUpdateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content ">
        <div class="modal-header">
          <h5 class="modal-title" id="userUpdateModalLabel">Cập nhật đơn hàng</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body  ">
          <div class="d-flex justify-content-end mb-4 fixed-bottom-3 "><input type="search" value=""
              placeholder="Search...." class="input-group-text w-50 text-start "></div>
          <div class="row">
            <form class="forms-sample col-lg-5 border rounded-4">
              <div class="form-group text-center mt-2">
                <h5>Thông tin khách hàng</h5>
              </div>
              <div class="row ">
                <div class="form-group col-lg mt-1">
                  <input type="search" class="form-control mt-4" id="exampleInputMiddleName"
                    placeholder="Search by phone or email" required ng-model="formOrderUpdate.search">
                </div>
                <div class="form-group col-lg justify-items-end">
                  <label for="exampleInputMiddleName">Tên Khách Hàng</label>
                  <input type="text" class="form-control" id="exampleInputMiddleName" placeholder="Họ và Tên" required
                    ng-model="formOrderUpdate.users[0].name">
                </div>
              </div>
              <div class="form-group">
                <label for="exampleInputDate">Mã hóa đơn</label>
                <input type="text" class="form-control" id="exampleInputDate" placeholder=""
                  ng-model="formOrderUpdate.code">
              </div>
              <div class="row ">
                <div class="form-group col-lg ">
                  <label for="exampleInputDate">Nhân viên</label>
                  <input type="search" class="form-control" id="exampleInputMiddleName"
                    placeholder="Search by phone or email" required ng-model="formOrderUpdate.staff[0].name">
                </div>
                <div class="form-group col-lg justify-items-end">
                  <label for="exampleInputMiddleName">Số điện thoại</label>
                  <input type="text" class="form-control" id="exampleInputMiddleName" placeholder="Họ và Tên" required
                    ng-model="formOrderUpdate.staff[0].phoneNumber">
                </div>
              </div>
              <div class="row ">
                <div class="form-group col-lg ">
                  <label for="exampleInputDate">Địa chỉ</label>
                  <!-- <input type="search" class="form-control mb-2" id="exampleInputMiddleName" placeholder="Tỉnh/Thành phố" required
                    ng-model="formOrderUpdate.province">
                  <input type="search" class="form-control mb-2" id="exampleInputMiddleName" placeholder="Quận/Huyện" required
                    ng-model="formOrderUpdate.district">
                  <input type="search" class="form-control" id="exampleInputMiddleName" placeholder="Phường/Xã" required
                    ng-model="formOrderUpdate.ward"> -->
                  <select id="select1" class="form-select col" ng-model="formOrderUpdate.province"
                    ng-change="loadDistrict(formOrderUpdate.province)" >
                    <option value="">Tỉnh/Thành phố
                    </option>
                    <option ng-repeat="provin in provinces" ng-value="provin.ProvinceID">
                      {{provin.ProvinceName}}</option>
                  </select>
                  <select id="select2" class="form-select col" ng-model="formOrderUpdate.district"
                    ng-change="loadWard(formOrderUpdate.district)">
                    <option value="">Quận/Huyện</option>
                    <option ng-repeat="district in districts" ng-value="district.DistrictID">
                      {{district.DistrictName}}</option>
                  </select>
                  <select id="select3" class="form-select col" ng-model="formOrderUpdate.ward">
                    <option value="">Phường/Xã</option>
                    <option ng-repeat="ward in wards" ng-value="ward.WardCode">{{ward.WardName}}</option>
                  </select>
                </div>
                <div class="form-group col-lg justify-items-end">
                  <label for="exampleInputMiddleName">Địa chỉ chi tiết</label>
                  <textarea type="text" class="form-control" id="exampleInputMiddleName" placeholder="Họ và Tên"
                    required ng-model="formOrderUpdate.address"></textarea>
                </div>
              </div>
              <div class="row ">
                <div class="form-group col-lg ">
                  <label for="exampleInputDate">Khuyến mãi</label>
                  <input type="search" class="form-control" id="exampleInputMiddleName"
                    placeholder="Search by phone or email" required ng-model="formOrderUpdate.fee">
                </div>
                <div class="form-group col-lg justify-items-end ">
                  <label for="exampleInputMiddleName">Tổng tiền sản phẩm</label>
                  <input type="text" class="form-control" id="exampleInputMiddleName" placeholder="Họ và Tên" required
                    ng-model="formOrderUpdate.totalPay">
                </div>
              </div>
              <div class="row ">
                <div class="form-group col-lg ">
                  <label for="exampleInputDate">Phương thức mua hàng</label>
                  <input type="search" class="form-control" id="exampleInputMiddleName"
                    placeholder="Search by phone or email" required ng-model="formOrderUpdate.paymentOptions">
                </div>
                <div class="form-group col-lg justify-items-end">
                  <label for="exampleInputMiddleName">Phương thức thanh toán</label>
                  <input type="text" class="form-control" id="exampleInputMiddleName" placeholder="Họ và Tên" required
                    ng-model="formOrderUpdate.paymentOptions">
                </div>
              </div>
            </form>
            <div class="col-lg scrollable-modal-body border rounded-4">
              <div class="text-center mt-2 mb-4">
                <h5>Giỏ hàng</h5>
              </div>
              <table class="table   table-hover">
                <thead class="sticky-top fs-4 thead-light">
                  <tr class="fs-1">
                    <th>#</th>
                    <th>Sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Thành tiền</th>
                  </tr>
                </thead>
                <tbody class="align-middle text-center table-group-divider">
                  <tr ng-repeat="pr in formOrderUpdate.listBillDetail"varStatus="loop" >
                    <td>{{$index +1}}</td>
                    <td>{{pr.productDetail.product.name}}</td>
                    <td>{{pr.quantity}}</td>
                    <td>{{pr.productDetail.price | vndCurrency }}</td>
                    <td>{{totalPrices[$index]  | vndCurrency}}</td>
                  </tr>

                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="btn-action-cancel" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button id="btn-action-add" type="button" class="btn btn-primary"
            ng-click="UpdateUser($event)">Submit</button>
        </div>
      </div>
    </div>
  </div>

  <div class="import-container">
    <div ng-show="importing" class="import-animation"></div>
    <p ng-show="importing">Processing...</p>
  </div>
  <Script>
    function triggerFileInput() {
      // Kích hoạt sự kiện click trên input-file
      document.getElementById('input-file').click();
    }
  </Script>


  <Script>
    $(document).ready(function () {
      $('.dropdown-toggle').dropdown();
    });
  </Script>